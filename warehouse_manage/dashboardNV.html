<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="css/product.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="js/jquery-3.7.js"></script>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h2>Trang chính</h2>
        <ul>
            <li><a href="#" class="menu-link" data-page="api/get_account_self.php">Thông Tin Tài Khoản</a></li>
            <li><a href="#" class="menu-link" data-page="api/get_sanpham.php?status=show">Sản Phẩm</a></li>
            <li><a href="#" class="menu-link" data-page="api/get_yeucau.php?status=pending_denied">Yêu Cầu Nhập Hàng</a></li>
            <li><a href="#" class="menu-link" data-page="api/get_donhang.php">Duyệt Đơn Hàng</a></li>
            <li><a href="#" class="menu-link" data-page="api/get_xuat.php">Xuất Kho</a></li>
            <li><a href="#" class="menu-link" data-page="api/get_hoadon.php">Hoá Đơn</a></li>
        </ul>
        <a href="logout.php" class="logout-btn">Đăng xuất</a>
    </div>

    <!-- Nội dung chính -->
    <div id="content">
        <div class="main-contents">
            <!-- Nội dung động sẽ được tải vào đây -->
        </div>
    </div>

    <!-- Modal Sửa Thông Tin Tài Khoản -->
    <div id="editAccountModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close">x</span>
            <form id="editAccountForm">
                <input type="hidden" name="UserID">
                <input type="text" name="UserName" placeholder="UserName" required>
                <input type="password" name="PassWord" placeholder="Nhập mật khẩu mới (để trống nếu không đổi)">
                <button type="submit">Cập nhật Tài Khoản</button>
            </form>
        </div>
    </div>
    <!-- Modal Tạo Yêu Cầu Nhập Hàng -->
    <div id="addRequestModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close">x</span>
            <form id="addRequestForm">
                <!-- Mã Phiếu Nhập: Ẩn vì sẽ tự động sinh -->
                <input type="hidden" name="MaPN" id="MaPN">
                <!-- Mã Nhà Cung Cấp: Hiển thị dưới dạng select -->
                <select name="MaNCC" id="MaNCC" required>
                    <option value="">Chọn Nhà Cung Cấp</option>
                    <!-- Danh sách nhà cung cấp sẽ được điền bằng JavaScript -->
                </select>
                <!-- Ngày Nhập: Tự động lấy ngày hiện tại -->
                <input type="date" name="NgayNhap" id="NgayNhap" required>
                <!-- Mã Nhân Viên: Ẩn -->
                <input type="hidden" name="MaNV" id="MaNV">
                <!-- Mã Hoá Đơn: Ẩn vì sẽ tự động sinh -->
                <input type="hidden" name="MaHoaDon" id="MaHoaDon">
                <h4>Chi Tiết Sản Phẩm</h4>
                <div id="productDetails">
                    <div class="product-detail">
                        <select name="MaSP[]" class="product-select" required>
                            <option value="">Chọn Sản Phẩm</option>
                            <!-- Danh sách sản phẩm sẽ được điền bằng JavaScript -->
                        </select>
                        <input type="number" name="SoLuongNhap[]" class="quantity-input" placeholder="Số Lượng Nhập" required>
                        <input type="number" step="0.01" name="GiaNhap[]" class="price-input" placeholder="Giá Nhập" required>
                    </div>
                </div>
                <button type="submit">Tạo Yêu Cầu</button>
            </form>
        </div>
    </div>
    <!-- Modal Chi tiết Yêu Cầu Nhập Hàng -->
    <div id="detailRequestModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close">x</span>
            <h2>Chi Tiết Phiếu Nhập</h2>
                <table class="product-table">
                    <thead>
                        <tr>
                            <th>Mã Phiếu Nhập</th>
                            <th>Mã Sản Phẩm</th>
                            <th>Số Lượng Nhập</th>
                            <th>Giá Nhập</th>
                            <th>Thành Tiền</th>
                        </tr>
                    </thead>
                    <tbody id="detailRequestBody">
                        <!-- Dữ liệu sẽ được điền bằng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Modal Chi tiết Đơn Hàng -->
    <div id="detailOrderModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close">x</span>
            <h3>Chi tiết đơn hàng</h3>
            <table id="detailOrderTable" class="detailTable">
                <thead>
                    <tr>
                        <th>Mã Chi Tiết</th>
                        <th>Mã Đơn</th>
                        <th>Mã Sản Phẩm</th>
                        <th>Số Lượng</th>
                        <th>Đơn Giá</th>
                        <th>Thành Tiền</th>
                    </tr>
                </thead>
                <tbody id="detailOrderBody">
                    <!-- Dữ liệu chi tiết sẽ được điền bằng JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- Modal Chi tiết Xuất kho -->
    <div id="detailExportModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close">x</span>
            <h3>Chi tiết sản phẩm xuất kho</h3>
            <table id="detailExportTable" class="detailTable">
                <thead>
                    <tr>
                        <th>Mã Phiếu Xuất</th>
                        <th>Mã Sản Phẩm</th>
                        <th>Tên Sản Phẩm</th>
                        <th>Số Lượng Xuất</th>
                        <th>Giá Xuất</th>
                        <th>Thành Tiền</th>
                    </tr>
                </thead>
                <tbody id="detailExportBody">
                    <!-- Dữ liệu chi tiết sẽ được điền bằng JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            // Giả lập MaNV của nhân viên đang đăng nhập (lấy từ session hoặc API)
            let MaNV = "NV001"; // Thay bằng cách lấy từ session hoặc API thực tế
            $("#MaNV").val(MaNV);

            // Load trang mặc định
            loadPage("api/get_account_self.php");

            // Xử lý click menu
            $(".menu-link").click(function (e) {
                e.preventDefault();
                var page = $(this).data("page");
                loadPage(page);
            });

            // Hàm đóng modal chung
            function setupModalClose(modalId) {
                $(`#${modalId} .close`).on("click", function () {
                    $(`#${modalId}`).fadeOut();
                });
                $(window).on("click", function (event) {
                    if ($(event.target).is(`#${modalId}`)) {
                        $(`#${modalId}`).fadeOut();
                    }
                });
            }

            // Thiết lập đóng modal cho tất cả modal
            setupModalClose("editAccountModal");
            setupModalClose("addRequestModal");
            setupModalClose("detailRequestModal");
            setupModalClose("detailOrderModal");
            setupModalClose("detailExportModal");
            function formatDate(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            function loadPage(page) {
                // 1. Thông Tin Tài Khoản
                if (page === "api/get_account_self.php") {
                    $.ajax({
                        url: page,
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            if (data.success && data.data) {
                                let account = data.data;
                                // Sử dụng placeholder 3x4 nếu không có hình ảnh
                                let userImage = account.Image ? account.Image : "https://placehold.co/150x200?text=User+Image"; // Placeholder 3x4 (150x200)

                                let contentHtml = `
                                    <div class="table-container">
                                        <h2>Thông Tin Tài Khoản</h2>
                                        <img src="${userImage}" alt="User Image" class="user-image">
                                        <div class="account-info">
                                            <label><strong>ID:</strong> ${account.UserID}</label><br>
                                            <label><strong>Tên Đăng Nhập:</strong> ${account.UserName}</label><br>
                                        </div>
                                        <button class="edit-btn" data-id="${account.UserID}">Sửa Thông Tin</button>
                                    </div>
                                `;
                                $("#content .main-contents").html(contentHtml);

                                $(".edit-btn").on("click", function () {
                                    const userId = $(this).data("id");
                                    $("#editAccountForm input[name='UserID']").val(account.UserID);
                                    $("#editAccountForm input[name='UserName']").val(account.UserName);
                                    $("#editAccountForm input[name='PassWord']").val("");
                                    $("#editAccountModal").fadeIn();
                                });

                                $("#editAccountForm").on("submit", function (event) {
                                    event.preventDefault();
                                    $.ajax({
                                        type: "POST",
                                        url: "api/editAccount.php",
                                        data: $(this).serialize(),
                                        success: function (response) {
                                            if (response.success) {
                                                alert("Tài khoản đã được cập nhật!");
                                                $("#editAccountModal").fadeOut();
                                                loadPage("api/get_account_self.php");
                                            } else {
                                                alert("Cập nhật thất bại: " + (response.message || "Lỗi không xác định"));
                                            }
                                        },
                                        error: function () {
                                            alert("Lỗi khi kết nối đến server!");
                                        }
                                    });
                                });
                            } else {
                                $("#content .main-contents").html("<p>Không tìm thấy thông tin tài khoản!</p>");
                            }
                        },
                        error: function (xhr, status, error) {
                            $("#content .main-contents").html("<p>Lỗi khi tải dữ liệu: " + error + "</p>");
                        }
                    });
                }
                // 2. Xem Sản Phẩm (chỉ trạng thái show)
                else if (page === "api/get_sanpham.php?status=show") {
                    $.ajax({
                        url: page,
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            let contentHtml = `
                                <div class="table-container">
                                    <table class="product-table">
                                        <thead>
                                            <tr>
                                                <th>Mã SP</th>
                                                <th>Tên SP</th>
                                                <th>Loại SP</th>
                                                <th>Kích Cỡ</th>
                                                <th>Màu sắc</th>
                                                <th>Giá nhập</th>
                                                <th>Giá xuất</th>
                                                <th>Số lượng tồn</th>
                                                <th>Nhập lần đầu</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                            `;
                            data.forEach(product => {
                                contentHtml += `
                                    <tr>
                                        <td>${product.MaSP}</td>
                                        <td>${product.TenSP}</td>
                                        <td>${product.LoaiSP}</td>
                                        <td>${product.KichCo}</td>
                                        <td>${product.MauSac}</td>
                                        <td>${product.GiaNhap}</td>
                                        <td>${product.GiaXuat}</td>
                                        <td>${product.SoLuongTon}</td>
                                        <td>${product.NgayNhap}</td>
                                    </tr>
                                `;
                            });
                            contentHtml += `
                                        </tbody>
                                    </table>
                                </div>
                            `;
                            $("#content .main-contents").html(contentHtml);
                        },
                        error: function (xhr, status, error) {
                            $("#content .main-contents").html("<p>Lỗi khi tải dữ liệu: " + error + "</p>");
                        }
                    });
                }
                // 3. Xem Yêu Cầu Nhập Hàng (pending và denied)
                else if (page === "api/get_yeucau.php?status=pending_denied") {
                    $.ajax({
                        url: page,
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            let contentHtml = `
                                <div class="table-container">
                                    <table class="product-table">
                                        <thead>
                                            <tr>
                                                <th>Mã Phiếu Nhập</th>
                                                <th>Nhà Cung Cấp</th>
                                                <th>Ngày Nhập</th>
                                                <th>Mã Nhân Viên</th>
                                                <th>Trạng Thái</th>
                                                <th>Mã Hoá Đơn</th>
                                                <th>Chi Tiết</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                            `;
                            if (Array.isArray(data) && data.length > 0) {
                                data.forEach(request => {
                                    contentHtml += `
                                        <tr>
                                            <td>${request.MaPN}</td>
                                            <td>${request.MaNCC}</td>
                                            <td>${request.NgayNhap}</td>
                                            <td>${request.MaNV}</td>
                                            <td>${request.TrangThai}</td>
                                            <td>${request.MaHoaDon}</td>
                                            <td>
                                                <button class="detail-btn" data-id="${request.MaPN}">Chi Tiết</button>
                                            </td>
                                        </tr>
                                    `;
                                });
                            } else {
                                contentHtml += `
                                    <tr>
                                        <td colspan="7">Không có yêu cầu nhập kho</td>
                                    </tr>
                                `;
                            }
                            contentHtml += `
                                        </tbody>
                                    </table>
                                    <button id="addRequestBtn" class="addRequestBtn">Tạo Yêu Cầu Nhập Hàng</button>
                                </div>
                            `;
                            $("#content .main-contents").html(contentHtml);

                            // Xử lý nút Tạo Yêu Cầu
                            $("#addRequestBtn").on("click", function () {
                                // Load danh sách nhà cung cấp
                                $.ajax({
                                    url: "api/get_nhacungcap.php",
                                    type: "GET",
                                    dataType: "json",
                                    success: function (nccList) {
                                        let options = '<option value="">Chọn Nhà Cung Cấp</option>';
                                        nccList.forEach(ncc => {
                                            options += `<option value="${ncc.MaNCC}">${ncc.TenNCC} (${ncc.MaNCC})</option>`;
                                        });
                                        $("#MaNCC").html(options);
                                    },
                                    error: function () {
                                        alert("Lỗi khi tải danh sách nhà cung cấp!");
                                    }
                                });

                                // Load danh sách sản phẩm
                                $.ajax({
                                    url: "api/get_sanpham.php?status=show",
                                    type: "GET",
                                    dataType: "json",
                                    success: function (products) {
                                        let options = '<option value="">Chọn Sản Phẩm</option>';
                                        products.forEach(product => {
                                            options += `<option value="${product.MaSP}">${product.TenSP} (${product.SoLuongTon})</option>`;
                                        });
                                        $("#addRequestForm select[name='MaSP[]']").html(options);
                                    },
                                    error: function () {
                                        alert("Lỗi khi tải danh sách sản phẩm!");
                                    }
                                });

                                // Tự động sinh Mã Phiếu Nhập (MaPN)
                                $.ajax({
                                    url: "api/generate_ma.php",
                                    type: "GET",
                                    data: { type: "PhieuNhap" },
                                    dataType: "json",
                                    success: function (response) {
                                        if (response.success) {
                                            $("#MaPN").val(response.MaPN);
                                        } else {
                                            alert("Lỗi khi sinh Mã Phiếu Nhập!");
                                        }
                                    },
                                    error: function () {
                                        alert("Lỗi khi sinh Mã Phiếu Nhập!");
                                    }
                                });

                                // Tự động sinh Mã Hoá Đơn (MaHoaDon)
                                $.ajax({
                                    url: "api/generate_ma.php",
                                    type: "GET",
                                    data: { type: "HoaDon" },
                                    dataType: "json",
                                    success: function (response) {
                                        if (response.success) {
                                            $("#MaHoaDon").val(response.MaHoaDon);
                                        } else {
                                            alert("Lỗi khi sinh Mã Hoá Đơn!");
                                        }
                                    },
                                    error: function () {
                                        alert("Lỗi khi sinh Mã Hoá Đơn!");
                                    }
                                });

                                // Tự động điền ngày hiện tại
                                const today = new Date();
                                $("#NgayNhap").val(formatDate(today));

                                $("#addRequestModal").fadeIn();
                            });

                        
                            

                            // Xử lý submit form tạo yêu cầu
                            $("#addRequestForm").on("submit", function (event) {
                                event.preventDefault();
                                $.ajax({
                                    type: "POST",
                                    url: "api/addRequest.php",
                                    data: $(this).serialize(),
                                    success: function (response) {
                                        if (response.success) {
                                            alert("Yêu cầu nhập hàng đã được tạo!");
                                            loadPage("api/get_yeucau.php?status=pending_denied");
                                            $("#addRequestModal").fadeOut();
                                            loadPage("api/get_yeucau.php?status=pending_denied");
                                        } else {
                                            alert("Tạo yêu cầu thất bại: " + (response.message || "Lỗi không xác định"));
                                        }
                                    },
                                    error: function () {
                                        alert("Lỗi khi kết nối đến server!");
                                    }
                                });
                            });

                            // Xử lý nút Chi Tiết
                            $(".detail-btn").on("click", function () {
                                const requestId = $(this).data("id");
                                $.ajax({
                                    url: "api/get_chitietyeucau.php",
                                    type: "GET",
                                    data: { MaPN: requestId },
                                    dataType: "json",
                                    success: function (response) {
                                        if (response.success) {
                                            $("#detailRequestBody").empty();
                                            if (Array.isArray(response.data) && response.data.length > 0) {
                                                response.data.forEach(product => {
                                                    $("#detailRequestBody").append(`
                                                        <tr>
                                                            <td>${product.MaPN}</td>
                                                            <td>${product.MaSP}</td>
                                                            <td>${product.SoLuongNhap}</td>
                                                            <td>${product.GiaNhap}</td>
                                                            <td>${product.ThanhTien.toLocaleString('vi-VN')}</td>
                                                        </tr>
                                                    `);
                                                });
                                            } else {
                                                $("#detailRequestBody").append(`
                                                    <tr>
                                                        <td colspan="5">Không có sản phẩm nào cho phiếu nhập này</td>
                                                    </tr>
                                                `);
                                            }
                                            $("#detailRequestModal").fadeIn();
                                        } else {
                                            alert("Lấy chi tiết thất bại: " + (response.message || "Lỗi không xác định"));
                                        }
                                    },
                                    error: function () {
                                        alert("Lỗi khi kết nối đến server!");
                                    }
                                });
                            });
                        },
                        error: function (xhr, status, error) {
                            $("#content .main-contents").html("<p>Lỗi khi tải dữ liệu: " + error + "</p>");
                        }
                    });
                }
                // 4. Duyệt Đơn Hàng Từ Cửa Hàng
                else if (page === "api/get_donhang.php") {
                    $.ajax({
                        url: page,
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            let contentHtml = `
                                <div class="table-container">
                                    <table class="product-table">
                                        <thead>
                                            <tr>
                                                <th>Mã Đơn</th>
                                                <th>Mã Phiếu Xuất</th>
                                                <th>Mã Cửa Hàng</th>
                                                <th>Ngày Đặt</th>
                                                <th>Trạng Thái</th>
                                                <th>Chi Tiết</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                            `;
                            if (Array.isArray(data) && data.length > 0) {
                                data.forEach(order => {
                                    contentHtml += `
                                        <tr>
                                            <td>${order.MaDon}</td>
                                            <td>${order.MaPX || 'N/A'}</td>
                                            <td>${order.MaCH}</td>
                                            <td>${order.NgayDat}</td>
                                            <td>
                                                ${order.TrangThai === 'pending' ?
                                            `<button class="approve-btn" data-id="${order.MaDon}">Duyệt</button>` :
                                            order.TrangThai}
                                            </td>
                                            <td>
                                                <button class="detail-btn" data-id="${order.MaDon}">Chi Tiết</button>
                                            </td>
                                        </tr>
                                    `;
                                });
                            } else {
                                contentHtml += `
                                    <tr>
                                        <td colspan="6">Không có đơn hàng đang chờ xử lý</td>
                                    </tr>
                                `;
                            }
                            contentHtml += `
                                        </tbody>
                                    </table>
                                </div>
                            `;
                            $("#content .main-contents").html(contentHtml);

                            $(".approve-btn").on("click", function () {
                                const orderId = $(this).data("id");
                                $.ajax({
                                    url: "api/approve_order.php",
                                    type: "POST",
                                    data: { MaDon: orderId },
                                    success: function (response) {
                                        if (response.success) {
                                            alert("Đơn hàng đã được duyệt!");
                                            loadPage("api/get_donhang.php");
                                        } else {
                                            alert("Duyệt đơn hàng thất bại: " + (response.message || "Lỗi không xác định"));
                                        }
                                    },
                                    error: function () {
                                        alert("Lỗi khi kết nối đến server!");
                                    }
                                });
                            });

                            $(".detail-btn").on("click", function () {
                                const orderId = $(this).data("id");
                                $.ajax({
                                    url: "api/get_chitietdonhang.php",
                                    type: "GET",
                                    data: { MaDon: orderId },
                                    dataType: "json",
                                    success: function (response) {
                                        if (response.success) {
                                            $("#detailOrderBody").empty();
                                            if (Array.isArray(response.data) && response.data.length > 0) {
                                                response.data.forEach(product => {
                                                    const thanhTien = product.SoLuong * product.DonGia;
                                                    $("#detailOrderBody").append(`
                                                        <tr>
                                                            <td>${product.MaChiTiet}</td>
                                                            <td>${product.MaDon}</td>
                                                            <td>${product.MaSP}</td>
                                                            <td>${product.SoLuong || 'N/A'}</td>
                                                            <td>${product.DonGia}</td>
                                                            <td>${thanhTien}</td>
                                                        </tr>
                                                    `);
                                                });
                                            } else {
                                                $("#detailOrderBody").append(`
                                                    <tr>
                                                        <td colspan="6">Không có sản phẩm nào cho đơn hàng này</td>
                                                    </tr>
                                                `);
                                            }
                                            $("#detailOrderModal").fadeIn();
                                        } else {
                                            alert("Lấy chi tiết thất bại: " + (response.message || "Lỗi không xác định"));
                                        }
                                    },
                                    error: function () {
                                        alert("Lỗi khi lấy chi tiết đơn hàng!");
                                    }
                                });
                            });
                        },
                        error: function (xhr, status, error) {
                            $("#content .main-contents").html("<p>Lỗi khi tải dữ liệu: " + error + "</p>");
                        }
                    });
                }
                // 5. Xem Xuất Kho Theo MaNV
                else if (page === "api/get_xuat.php") {
                    $.ajax({
                        url: page,
                        type: "GET",
                        data: { MaNV: MaNV },
                        dataType: "json",
                        success: function (data) {
                            let contentHtml = `
                                <div class="table-container">
                                    <table class="product-table">
                                        <thead>
                                            <tr>
                                                <th>Mã Phiếu Xuất</th>
                                                <th>Ngày Xuất</th>
                                                <th>Mã Nhân Viên</th>
                                                <th>Mã Cửa Hàng</th>
                                                <th>Mã Hoá Đơn</th>
                                                <th>Chi Tiết</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                            `;
                            if (Array.isArray(data) && data.length > 0) {
                                data.forEach(xuat => {
                                    contentHtml += `
                                        <tr>
                                            <td>${xuat.MaPX}</td>
                                            <td>${xuat.NgayXuat}</td>
                                            <td>${xuat.MaNV}</td>
                                            <td>${xuat.MaCH}</td>
                                            <td>${xuat.MaHoaDon}</td>
                                            <td>
                                                <button class="detail-btn" data-id="${xuat.MaPX}">Chi Tiết</button>
                                            </td>
                                        </tr>
                                    `;
                                });
                            } else {
                                contentHtml += `
                                    <tr>
                                        <td colspan="6">Không có phiếu xuất nào</td>
                                    </tr>
                                `;
                            }
                            contentHtml += `
                                        </tbody>
                                    </table>
                                </div>
                            `;
                            $("#content .main-contents").html(contentHtml);

                            $(".detail-btn").on("click", function () {
                                const requestId = $(this).data("id");
                                $.ajax({
                                    url: "api/get_chitietxuat.php",
                                    type: "GET",
                                    data: { MaPX: requestId },
                                    dataType: "json",
                                    success: function (response) {
                                        if (response.success) {
                                            $("#detailExportBody").empty();
                                            if (Array.isArray(response.data) && response.data.length > 0) {
                                                response.data.forEach(product => {
                                                    const thanhTien = product.SoLuongXuat * product.GiaXuat;
                                                    $("#detailExportBody").append(`
                                                        <tr>
                                                            <td>${product.MaPX}</td>
                                                            <td>${product.MaSP}</td>
                                                            <td>${product.TenSP}</td>
                                                            <td>${product.SoLuongXuat}</td>
                                                            <td>${product.GiaXuat}</td>
                                                            <td>${thanhTien}</td>
                                                        </tr>
                                                    `);
                                                });
                                            } else {
                                                $("#detailExportBody").append(`
                                                    <tr>
                                                        <td colspan="6">Không có sản phẩm nào cho phiếu xuất này</td>
                                                    </tr>
                                                `);
                                            }
                                            $("#detailExportModal").fadeIn();
                                        } else {
                                            alert("Lấy chi tiết thất bại: " + (response.message || "Lỗi không xác định"));
                                        }
                                    },
                                    error: function () {
                                        alert("Lỗi khi lấy chi tiết sản phẩm xuất kho!");
                                    }
                                });
                            });
                        },
                        error: function (xhr, status, error) {
                            $("#content .main-contents").html("<p>Lỗi khi tải dữ liệu: " + error + "</p>");
                        }
                    });
                }
                // 6. Xem Hoá Đơn Theo MaNV
                else if (page === "api/get_hoadon.php") {
                    $.ajax({
                        url: page,
                        type: "GET",
                        data: { MaNV: MaNV },
                        dataType: "json",
                        success: function (data) {
                            let contentHtml = `
                                <div class="table-container">
                                    <table class="product-table">
                                        <thead>
                                            <tr>
                                                <th>Mã Hoá Đơn</th>
                                                <th>Loại Phiếu</th>
                                                <th>Ngày Thực Hiện</th>
                                                <th>Mã Nhân viên</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                            `;
                            if (Array.isArray(data) && data.length > 0) {
                                data.forEach(hoadon => {
                                    contentHtml += `
                                        <tr>
                                            <td>${hoadon.MaHoaDon}</td>
                                            <td>${hoadon.LoaiPhieu}</td>
                                            <td>${hoadon.NgayThucHien}</td>
                                            <td>${hoadon.MaNV}</td>
                                        </tr>
                                    `;
                                });
                            } else {
                                contentHtml += `
                                    <tr>
                                        <td colspan="4">Không có hóa đơn nào</td>
                                    </tr>
                                `;
                            }
                            contentHtml += `
                                        </tbody>
                                    </table>
                                </div>
                            `;
                            $("#content .main-contents").html(contentHtml);
                        },
                        error: function (xhr, status, error) {
                            $("#content .main-contents").html("<p>Lỗi khi tải dữ liệu: " + error + "</p>");
                        }
                    });
                }
            }
        });
    </script>
</body>

</html>